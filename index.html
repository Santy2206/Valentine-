<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For My Favorite Engineer</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ù§Ô∏è</text></svg>">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');

        :root {
            --bg-color: #fff5f8;
            --kuromi-purple: #9b59b6;
            --snoopy-pink: #ff80ab;
            --stem-green: #4caf50;
            --rose-red: #d32f2f;
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--bg-color);
            font-family: 'Fredoka', sans-serif;
            touch-action: none;
        }

        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* --- STAGE 1: ROSE BOUQUET --- */
        #intro-screen { z-index: 40; background: radial-gradient(circle, #fff, #ffebee); }
        
        .bouquet {
            position: relative;
            width: 300px;
            height: 400px;
            display: flex;
            justify-content: center;
        }

        .flower { position: absolute; bottom: 100px; transform-origin: bottom center; }
        .stem { width: 6px; height: 180px; background: var(--stem-green); border-radius: 10px; box-shadow: inset -2px 0 3px rgba(0,0,0,0.2); }
        
        .petal-group {
            position: absolute;
            top: -10px; left: 50%;
            transform: translate(-50%, -50%) scale(0);
        }

        .rose-petal {
            position: absolute;
            border-radius: 50% 0% 50% 50%; 
            transform-origin: bottom right;
            box-shadow: inset -3px -3px 8px rgba(0,0,0,0.3);
            border: 1px solid rgba(139,0,0,0.5);
        }

        .rose-center {
            position: absolute;
            width: 20px; height: 20px;
            background: #8e0000;
            border-radius: 50%;
            top: -10px; left: -10px;
            z-index: 5;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.5);
        }

        /* --- STAGE 2: RULES --- */
        #rules-screen { z-index: 30; display: none; background: rgba(255,235,238,0.9); backdrop-filter: blur(5px); }

        /* --- STAGE 3: GAME --- */
        #game-screen { z-index: 20; display: none; background: #fce4ec; }
        #score-board {
            position: absolute;
            top: 50px;
            background: white;
            padding: 10px 25px;
            border-radius: 30px;
            font-size: 1.4rem;
            color: #d81b60;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            font-weight: 600;
            border: 2px solid #f8bbd0;
        }

        /* --- STAGE 4: PROPOSAL --- */
        #proposal-screen { z-index: 10; display: none; }
        .card {
            background: white;
            padding: 30px;
            border-radius: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            text-align: center;
            width: 85%;
            max-width: 380px;
            border: 2px solid #f8bbd0;
        }

        .photo-container {
            width: 100%;
            height: 220px;
            background: #eee;
            border-radius: 20px;
            margin-bottom: 15px;
            overflow: hidden;
            border: 3px solid var(--snoopy-pink);
        }

        .photo-container img { width: 100%; height: 100%; object-fit: cover; }

        .btn-group { 
            position: relative; 
            margin-top: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            width: 100%;
        }

        button {
            padding: 15px;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            font-family: 'Fredoka', sans-serif;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        button:active { transform: scale(0.95); }

        #yesBtn { background: var(--snoopy-pink); color: white; z-index: 100; }
        #noBtn { background: #f5f5f5; color: #888; }
        .start-btn { background: #d81b60; color: white; padding: 15px 30px; }

    </style>
</head>
<body>

    <div id="intro-screen" class="screen">
        <div class="bouquet" id="bouquet"></div>
        <h2 id="intro-text" style="color: #b71c1c; opacity: 0;">For my favorite Engineer...</h2>
        <button id="start-btn" class="start-btn" style="opacity: 0; margin-top: 20px;" onclick="goToRules()">Open Your Gift</button>
    </div>

    <div id="rules-screen" class="screen">
        <div class="card" id="rulesCard">
            <h2 style="color: #d81b60; font-size: 2rem; margin-top: 0;">How to Play</h2>
            <p style="font-size: 1.2rem; color: #333;">üê∂ Move Snoopy to catch things!</p>
            
            <div style="text-align: left; background: #fff5f8; padding: 15px; border-radius: 15px; margin: 15px 0;">
                <p style="font-size: 1.2rem; color: #c2185b; margin: 5px 0;"><strong>‚ù§Ô∏è Hearts: +10%</strong></p>
                <p style="font-size: 1.2rem; color: #1976d2; margin: 5px 0;"><strong>üíß Raindrops: +5%</strong></p>
                <p style="font-size: 1.2rem; color: #333; margin: 5px 0;"><strong>üíÄ Skulls: -15% (Ouch!)</strong></p>
            </div>
            
            <p style="font-size: 1.1rem; color: #777;">Reach 100% Love Meter to win.</p>
            <button class="start-btn" onclick="startGame()" style="width: 100%; margin-top: 10px;">Let's Go!</button>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <div id="score-board">Love Meter: <span id="scoreVal">0</span>%</div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <div id="proposal-screen" class="screen">
        <div class="card" id="finalCard">
            <div class="photo-container">
                <img id="proposal-img" src="Images/Question.jpeg" alt="Together">
            </div>
            <h2 style="color: #d81b60;">Dany, will you be my Valentine?</h2>
            <div class="btn-group">
                <button id="yesBtn" onclick="celebrate()">YES! ‚ù§Ô∏è</button>
                <button id="noBtn" onmouseover="makeYesBigger()" onclick="makeYesBigger()">No</button>
            </div>
        </div>
    </div>

    <script>
        // 1. GENERATE ROSE BOUQUET
        const bouquet = document.getElementById('bouquet');
        const flowerCount = 5;
        const outerColors = ['#d32f2f', '#c62828', '#b71c1c', '#e53935', '#ef5350'];
        const innerColors = ['#b71c1c', '#8e0000', '#5f0000'];

        for (let i = 0; i < flowerCount; i++) {
            const flower = document.createElement('div');
            flower.className = 'flower';
            flower.style.left = `${150 + (i - 2) * 35}px`;
            flower.style.rotate = `${(i - 2) * 12}deg`;

            const stem = document.createElement('div');
            stem.className = 'stem';
            stem.style.height = `${180 + Math.random() * 40}px`;

            const petals = document.createElement('div');
            petals.className = 'petal-group';
            
            const layerSizes = [45, 30, 18]; 
            for(let layer = 0; layer < 3; layer++) {
                for (let j = 0; j < 5; j++) {
                    const petal = document.createElement('div');
                    petal.className = 'rose-petal';
                    petal.style.width = `${layerSizes[layer]}px`;
                    petal.style.height = `${layerSizes[layer]}px`;
                    petal.style.background = layer === 0 ? outerColors[i] : innerColors[layer-1];
                    petal.style.rotate = `${(j * 72) + (layer * 20)}deg`;
                    
                    petal.style.top = `${-layerSizes[layer] / 2}px`;
                    petal.style.left = `${-layerSizes[layer] / 2}px`;

                    petals.appendChild(petal);
                }
            }

            const center = document.createElement('div');
            center.className = 'rose-center';
            petals.appendChild(center);

            flower.appendChild(stem);
            flower.appendChild(petals);
            bouquet.appendChild(flower);
        }

        // 2. INTRO ANIMATION (GSAP)
        const tl = gsap.timeline();
        tl.to(".stem", { height: (i) => 180 + (Math.random()*40), duration: 1.5, stagger: 0.2, ease: "power2.out" })
          .to(".petal-group", { scale: 1, duration: 1, stagger: 0.2, ease: "elastic.out(1, 0.5)" }, "-=1")
          .to("#intro-text", { opacity: 1, duration: 1 })
          .to("#start-btn", { opacity: 1, y: -10, duration: 0.5 });

        // 3. GAME LOGIC
        // --- NEW: Load the Dog Image ---
        const dogImage = new Image();
        dogImage.src = 'images/snoopy.png'; 
        const dogSize = 80; 

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameActive = false;
        let score = 0;
        let player = { x: 0, y: 0 };
        let items = [];

        function goToRules() {
            gsap.to("#intro-screen", { opacity: 0, duration: 0.5, onComplete: () => {
                document.getElementById('intro-screen').style.display = 'none';
                document.getElementById('rules-screen').style.display = 'flex';
                gsap.from("#rulesCard", { scale: 0.8, opacity: 0, duration: 0.5, ease: "back.out" });
            }});
        }

        function startGame() {
            gsap.to("#rules-screen", { opacity: 0, duration: 0.5, onComplete: () => {
                document.getElementById('rules-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'flex';
                resize();
                gameActive = true;
                score = 0; 
                items = []; 
                document.getElementById('scoreVal').innerText = score;
                gameLoop();
            }});
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            player.x = canvas.width / 2;
            player.y = canvas.height - 100;
        }

        window.addEventListener('touchmove', (e) => player.x = e.touches[0].clientX);
        window.addEventListener('mousemove', (e) => player.x = e.clientX);
        window.addEventListener('resize', resize);

        function gameLoop() {
            if (!gameActive) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // --- NEW: Drawing the custom image ---
            if (dogImage.complete) {
                ctx.drawImage(dogImage, player.x - (dogSize / 2), player.y - (dogSize / 2), dogSize, dogSize);
            }

            if (Math.random() < 0.08) { 
                const rand = Math.random();
                let emoji = '‚ù§Ô∏è', points = 10;
                
                if (rand > 0.35 && rand <= 0.70) {
                    emoji = 'üíß'; points = 5;
                } else if (rand > 0.70) {
                    emoji = 'üíÄ'; points = -15;
                }

                items.push({ 
                    x: Math.random() * (canvas.width - 50) + 25, 
                    y: -50, 
                    char: emoji,
                    points: points,
                    speed: 4 + Math.random() * 5 
                });
            }

            for (let i = items.length - 1; i >= 0; i--) {
                let item = items[i];
                item.y += item.speed;
                ctx.font = "40px Arial";
                ctx.fillText(item.char, item.x - 20, item.y);

                let dx = Math.abs(item.x - player.x);
                let dy = Math.abs(item.y - player.y + 20); 
                
                if (dx < 60 && dy < 60) {
                    score += item.points;
                    if (score < 0) score = 0; 
                    
                    document.getElementById('scoreVal').innerText = score;
                    items.splice(i, 1);
                } else if (item.y > canvas.height + 50) {
                    items.splice(i, 1);
                }
            }

            if (score >= 100) {
                gameActive = false;
                document.getElementById('scoreVal').innerText = "100";
                setTimeout(() => {
                    gsap.to("#game-screen", { opacity: 0, duration: 1, onComplete: showProposal });
                }, 500); 
            } else {
                requestAnimationFrame(gameLoop);
            }
        }
        // 4. PROPOSAL LOGIC
        function showProposal() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('proposal-screen').style.display = 'flex';
            gsap.from("#finalCard", { scale: 0, rotation: 10, duration: 1, ease: "back.out" });
        }

        let scale = 1;
        function makeYesBigger() {
            scale += 0.4; 
            gsap.to("#yesBtn", { scale: scale, duration: 0.2 });
            if(scale > 4) celebrate(); 
        }

        function celebrate() {
            document.getElementById('noBtn').style.display = 'none';
            document.querySelector('#finalCard h2').innerText = "I KNEW IT! ‚ù§Ô∏è";
            
            // --- NEW: Change the image here! ---
            // This is a cute Snoopy hugging a heart GIF
            document.getElementById('proposal-img').src = "images/Cat_Hugging.webp"; 

            gsap.to("#yesBtn", { scale: 1, duration: 0.3 }); 
            
            confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 }, colors: ['#ff80ab', '#d81b60', '#ffeb3b'] });
            setTimeout(() => { confetti({ particleCount: 100, spread: 120, origin: { y: 0.6 } })}, 1500);
        }
    </script>
</body>
</html>
